---
layout: default
title: Arrival ATFM Delay
excerpt: Performance Review Unit interactive dashboard on European Air Transport - Arrival ATFCM Delay data.
keywords: performance, air transport, flights, europe, cost efficiency
---
<script type="text/javascript" src="./json2csv.js"></script>
<script type="text/javascript" src="./FileSaver.min.js"></script>
<script type="text/javascript">
   $('select').select2();
</script>

<div class="container">
   <div class="page-header">
      <h1>Arrival ATFM Delay</h1>
      <p class="lead">Select the filters that best suit your needs and then press the Download button to get the relevant CSV file.</p>
   </div>

   <section id="data-array" class="row">
      <div class="row">
         <div class="btn-toolbar" role="toolbar" aria-label="Example">
            <div class="btn-group" role="group" aria-label="Example"><select id="arr-year" class="form-control"></select></div>
            <div class="btn-group" role="group" aria-label="Example"><select id="arr-country" class="form-control"></select></div>
            <div class="btn-group" role="group" aria-label="Example"><select id="arr-apt" class="form-control"></select></div>
            <div class="btn-group" role="group" aria-label="Example"><button id="arr-download" class="btn btn-primary btn-sm"><span class="glyphicon glyphicon-save"></span> Download</button></div>
         </div>
      </div>
      <div class="row col-xs-12 col-sm-12 col-lg-12 col-sm-12 col-md-12">
         <div class="dc-data-count">
            <span class="filter-count">
         </div>
      </div>
      <style type="text/css">
       .dc-data-count {
          float: right;
          margin-top: 15px;
          margin-right: 15px;
          margin-left: 25px;
       }

       .dc-data-count .filter-count, .total-count {
          color: #3182bd;
          font-weight: bold;
       }

       /* hide the sub-group summary*/
       #arr-data-table tr.dc-table-group {display: none;}
       table, th, td {
          border-bottom: 1px solid #CCCCCC; /* dim gray for reduced non-data ink */
       }
       th, td {
          padding: 3px;
       }
       /*align right for numeric columns*/
       td:nth-of-type(4),
       td:nth-of-type(5),
       td:nth-of-type(6),
       td:nth-of-type(7),
       td:nth-of-type(8),
       td:nth-of-type(9),
       td:nth-of-type(10),
       td:nth-of-type(11) {
          text-align: right;
       }
       #loading {
        text-align: center;
        position: absolute;
        padding-left: 200px;
        padding-top: 100px;
        height: 20px;
        font-size: 30px;
      }
      </style>
      <div class="col-xs-12 col-sm-12 col-lg-12 col-sm-12 col-md-12 dc-data-table table table-hover">
         <div id='arr-data-table'></div>
         <div id='loading'>Loading...</div>
      </div>
   </section>
</div>

<div class="row">
   <div>
      <div class="dc-data-count"></div>
   </div>
   <table class="table table-hover dc-data-table"></table>
</div>

<div class="clearfix"></div>

<script type="text/javascript">
   var dataFile    = 'Airport ATFM Delay.csv';
   var years; // the years in the dataset
   var countries; // the country names in the dataset
   var airports; // the (ICAO) airport IDs in the dataset
   var data;
   var loading = d3.selectAll("#loading");

   function filteredCSV(data) {
      var fields = [
        'YEAR',
        'MONTH_NUM',
        'MONTH_MON',
        'DATE_REG',
        'APT_COUNTRY',
        'APT_ICAO',
        'APT_NAME',
        'FLT_ARR_1',
        'FLT_DEP_1',
        'FLT_TOT_1',
        'DLY_APT_1',
        'DLY_APT_A_1',
        'DLY_APT_C_1',
        'DLY_APT_D_1',
        'DLY_APT_E_1',
        'DLY_APT_G_1',
        'DLY_APT_I_1',
        'DLY_APT_M_1',
        'DLY_APT_N_1',
        'DLY_APT_O_1',
        'DLY_APT_P_1',
        'DLY_APT_R_1',
        'DLY_APT_S_1',
        'DLY_APT_T_1',
        'DLY_APT_V_1',
        'DLY_APT_W_1',
        'DLY_APT_NA_1'
      ];

      json2csv({ data: data, fields: fields }, function(err, csv) {
         if (err) console.log(err);
         var blob = new Blob([csv], {type: "text/csv"});
         saveAs(blob, "arrival_atfcm_delay.csv");
      });
   }


   queue()
      .defer(d3.csv, dataFile)
      .await(function(error, arr) {
         var dateFormat = d3.time.format("%m-%Y"),
             fullDateFormat = d3.time.format("%d-%b-%y");

         arr.forEach(function(d, i) {
            d.YEAR = +d.YEAR;
            d.MONTH_NUM = +d.MONTH_NUM;
            d.date = dateFormat.parse(d.MONTH_NUM + "-" + d.YEAR);
            d.DATE_REG = fullDateFormat.parse(d.DATE_REG);
            d.APT_NAME = d.APT_NAME ? d.APT_NAME.trim() : '';
            d.APT_NAME = d.APT_NAME.length ? d.APT_NAME : 'ZZZ';
            d.APT_ICAO = d.APT_ICAO ? d.APT_ICAO : 'ZZZZ';
            d.APT_COUNTRY = d.APT_COUNTRY ? d.APT_COUNTRY.trim() : '';
            d.APT_COUNTRY = d.APT_COUNTRY.length ? d.APT_COUNTRY : 'ZZZ';
            d.FLT_ARR_1 = d.FLT_ARR_1 ? +d.FLT_ARR_1 : 0;
            d.FLT_DEP_1 = d.FLT_DEP_1 ? +d.FLT_DEP_1 : 0;
            d.FLT_TOT_1 = d.FLT_TOT_1 ? +d.FLT_TOT_1 : 0;
            d.DLY_APT_1 = d.DLY_APT_1 ? +d.DLY_APT_1 : 0;
            d.DLY_APT_A_1 = d.DLY_APT_A_1 ? +d.DLY_APT_A_1 : 0;
            d.DLY_APT_C_1 = d.DLY_APT_C_1 ? +d.DLY_APT_C_1 : 0;
            d.DLY_APT_D_1 = d.DLY_APT_D_1 ? +d.DLY_APT_D_1 : 0;
            d.DLY_APT_E_1 = d.DLY_APT_E_1 ? +d.DLY_APT_E_1 : 0;
            d.DLY_APT_G_1 = d.DLY_APT_G_1 ? +d.DLY_APT_G_1 : 0;
            d.DLY_APT_I_1 = d.DLY_APT_I_1 ? +d.DLY_APT_I_1 : 0;
            d.DLY_APT_M_1 = d.DLY_APT_M_1 ? +d.DLY_APT_M_1 : 0;
            d.DLY_APT_N_1 = d.DLY_APT_N_1 ? +d.DLY_APT_N_1 : 0;
            d.DLY_APT_O_1 = d.DLY_APT_O_1 ? +d.DLY_APT_O_1 : 0;
            d.DLY_APT_P_1 = d.DLY_APT_P_1 ? +d.DLY_APT_P_1 : 0;
            d.DLY_APT_R_1 = d.DLY_APT_R_1 ? +d.DLY_APT_R_1 : 0;
            d.DLY_APT_S_1 = d.DLY_APT_S_1 ? +d.DLY_APT_S_1 : 0;
            d.DLY_APT_T_1 = d.DLY_APT_T_1 ? +d.DLY_APT_T_1 : 0;
            d.DLY_APT_V_1 = d.DLY_APT_V_1 ? +d.DLY_APT_V_1 : 0;
            d.DLY_APT_W_1 = d.DLY_APT_W_1 ? +d.DLY_APT_W_1 : 0;
            d.DLY_APT_NA_1 = d.DLY_APT_NA_1 ? +d.DLY_APT_NA_1 : 0;
         });

         var xf = crossfilter(arr);
         var all = xf.groupAll();
         var arrDate = xf.dimension(function(d){return d.date;});

         var arrYear = xf.dimension(function(d){return d.YEAR;});
         var arrYearGroup = arrYear.group(Math.floor);

         var arrCountry = xf.dimension(function(d){return d.APT_COUNTRY;});
         var arrCountryGroup = arrCountry.group();

         var arrAirport = xf.dimension(function(d){return d.APT_ICAO;});
         var arrAirportGroup = arrAirport.group();


         // YEARS DROPDOWN
         // add an "All Years" item to the year dropdown menu
         d3.select("#arr-year")
            .append("option")
            .text("All Years")
            .attr("value", "-1");

         // fill the year dropdown menu with the available years from the dataset
         years = _.pluck(arrYearGroup.top(Infinity),"key");
         years.sort();
         years = years.map(function(d,i){return {id: i, 'text': d};});
         $("#arr-year").select2({
            data: years,
            minimumResultsForSearch: Infinity
         });

         // call filterByYear when a new selection is made
         $("#arr-year").on("change", function() {
            filterByYear(this.value);
         });


         // Countries DROPDOWN
         // add an "All Countries" item to the ansps dropdown menu
         d3.select("#arr-country")
            .append("option")
            .text("All Countries")
            .attr("value", "-1");

         // fill the countries dropdown menu with the available country names from the dataset
         countries = _.pluck(arrCountryGroup.top(Infinity),"key");
         countries.sort();
         countries = countries.map(function(d,i){return {id: i, 'text': d};});
         $("#arr-country").select2({
            data: countries
         });

         // call filterByCountry when a new selection is made
         $("#arr-country").on("change", function() {
            filterByCountry(this.value);
         });


         // AIRPORTS DROPDOWN
         // add an "All Airports" item to the airports dropdown menu
         d3.select("#arr-apt")
            .append("option")
            .text("All Airports")
            .attr("value", "-1");

         // fill the year dropdown menu with the available years from the dataset
         airports = _.pluck(arrAirportGroup.top(Infinity),"key");
         airports.sort();
         airports = airports.map(function(d,i){return {id: i, 'text': d};});
         $("#arr-apt").select2({
            data: airports
         });

         // call filterByAirport when a new selection is made
         $("#arr-apt").on("change", function() {
            filterByAirport(this.value);
         });


        loading.classed("hidden", true);


         // create a table to preview (a subset of) the filtered values
         var format = d3.format('02d');
         var dataTable = dc.dataTable('#arr-data-table')
            .dimension(arrDate)
            .group(function (d) {
               var format = d3.format('02d');
               return d.date.getFullYear() + '/' + format((d.date.getMonth() + 1));
            })
            .size(12) // (optional) max number of records to be shown, :default = 25
            .columns([
               {
                  label: 'YYYY/MM',
                  format: function (d) {
                   return d.date.getFullYear() + '/' + format((d.date.getMonth() + 1));
                  }
               },
               {
                  label: 'Country',
                  format: function (d) {
                     return d.APT_COUNTRY;
                  }
               },
               {
                  label: 'Regu date',
                  format: function(d) {
                    return d.DATE_REG.getFullYear() + '/' + format(d.DATE_REG.getUTCMonth() + 1) + '/' + format(d.DATE_REG.getUTCDate());
                  }
               },
              'APT_ICAO',
              'APT_NAME',
              'FLT_ARR_1',
              'FLT_DEP_1',
              'FLT_TOT_1',
              'DLY_APT_1',
              'DLY_APT_A_1',
              'DLY_APT_C_1',
              'DLY_APT_D_1',
              'DLY_APT_E_1',
              'DLY_APT_G_1',
              'DLY_APT_I_1',
              'DLY_APT_M_1',
              'DLY_APT_N_1',
              'DLY_APT_O_1',
              'DLY_APT_P_1',
              'DLY_APT_R_1',
              'DLY_APT_S_1',
              'DLY_APT_T_1',
              'DLY_APT_V_1',
              'DLY_APT_W_1',
              'DLY_APT_NA_1'
            ])
            .sortBy(function (d) {
               return d.date;
            })
            .order(d3.ascending);

         dc.dataCount('.dc-data-count')
            .dimension(xf)
            .group(all)
            // (optional) html, for setting different html for some records and all records.
            // .html replaces everything in the anchor with the html given using the following function.
            // %filter-count and %total-count are replaced with the values obtained.
            .html({
               some:'<strong>%filter-count</strong> selected out of <strong>%total-count</strong> records' +
               ' (only a max of <em>' + dataTable.size() + '</em> shown below.)',
               all:'All <strong>%total-count</strong> records selected'+
               ' (only a max of <em>' + dataTable.size() + '</em> shown below.)'
            });


         dc.renderAll();

         // TODO: finde a better place!
         // action linked to 'Download button'
         $(document).ready(function() {
            $("#arr-download").click(function() {
               filteredCSV(arrYear.top(Infinity));
            })
         });

         function filterByYear(val) {
            arrYear.filterAll();
            if (val == -1) {
            }
            else {
               arrYear.filter(function(d) {return d == +years[val].text});
            }
            dc.redrawAll();
         }

         function filterByCountry(val) {
            arrCountry.filterAll();
            if (val == -1) {
            }
            else {
               arrCountry.filter(function(d) {return d === countries[val].text});
            }
            dc.redrawAll();
         }

         function filterByAirport(val) {
            arrAirport.filterAll();
            if (val == -1) {
            }
            else {
               arrAirport.filter(function(d) {return d === airports[val].text});
            }
            dc.redrawAll();
         }
       });
</script>
